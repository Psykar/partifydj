<!DOCTYPE html>
<html xmlns:fb="http://ogp.me/ns/fb#">
<head>
<title>Spartify</title>
<link href="/static/spartify.css" rel="stylesheet">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="/static/ios-icon.png">
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26827170-1']);
  _gaq.push(['_setDomainName', 'spartify.com']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
<section id="intro">
	<h1><a class="go-main" href="/">PartifyDJ</a></h1>
	<p class="p-main" id="info">Host a party and let guests choose what songs to rock out to with a little help from our friend <a href="http://www.spotify.com/">Spotify</a>. No more huddling in front of one computer or messing up the queue! All drunk?? No worries we'll take care of the tunes for you!
</section>
<section class="p-main" id="actions">
	<p id="continue" style="display: none;"><button class="nav">Continue XXXXX</button>
	<ul id="fb-parties"></ul>
	<p><button class="nav" id="go-join">Join a party</button>
	<p><button class="nav create" id="start">Start a party!</button>
	<div id="facebook-login">
		<p>Log in with Facebook to find parties you're attending
		<p><fb:login-button scope="user_events" show-faces="true" width="200" max-rows="1"></fb:login-button>
	</div>
</section>
<section class="p-join" id="party-joiner">
	<p><input id="join-party-code" placeholder="Enter party code here">
	<p><button class="nav create" id="join">Join!</button>
	<p><button class="nav go-main">Go back</button>
</section>
<section class="p-party" id="party-room">
	<p id="party-code">Party code goes here
	<p><input id="search" placeholder="Search for songs">
	<ul class="song-list" id="results"></ul>
	<h2>Queue</h2>
	<ul class="song-list" id="queue"></ul>
	<p><button class="nav cancel go-main">Leave party :(</button>
</section>
<section class="p-about" id="about">
	<h2>About</h2>
	<p>PartifyDJ was developed by Stephane Rufer from a fork of <a href="www.spartify.com">Spartify</a>.</p>
	<p>PartifyDJ lets anyone with a smart phone go to www.partifydj.apppspot.com and enter
	the "party code", and then vote up the song(s) they want to hear next.
</section>
<section id="derp">
	<p>By Stephane Rufer.
	<p><a class="go-about" href="/about">read more about Spartify here</a>.
	<p><a href="http://the.echonest.com/"><img alt="Powered by The Echo Nest" src="http://the.echonest.com/media/images/logos/EN_P_on_White_Horizontal.gif"></a>
</section>
<iframe id="open" style="display: none;"></iframe>
<script src="/static/jquery-1.7.min.js"></script>
<script src="/static/spartify.js"></script>
<div id="fb-root"></div>
<script>
window.fbAsyncInit = function() {
	FB.init({
		appId: '373051182734312',
		status: true,
		cookie: true,
		xfbml: true
    });

	function checkEvents() {
		FB.api('/me/events', function(res) {
			console.log(res);
			if (!res.data) return;
			var events = {};
			var eventIds = res.data.map(function(evt) { events[evt.id] = evt; return evt.id; });
			spartify.api.findParties(eventIds, function(result) {
				for (var eventId in result) {
					$('#fb-parties').append(
						$('<li>').append(
							$('<a>')
								.attr('href', '/' + result[eventId])
								.text(events[eventId].name)));
				}
			}, null);
		});
	}

	FB.getLoginStatus(function(res) {
		if (res.status == 'connected') {
			checkEvents();
		} else {
			FB.Event.subscribe('auth.login', function(res) {
				checkEvents();
			});
		}
	});
};

(function(d) {
	var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	if (d.getElementById(id)) { return; }
	js = d.createElement('script'); js.id = id; js.async = true;
	js.src = '//connect.facebook.net/en_US/all.js';
	ref.parentNode.insertBefore(js, ref);
}(document));
</script>
</body>
</html>
